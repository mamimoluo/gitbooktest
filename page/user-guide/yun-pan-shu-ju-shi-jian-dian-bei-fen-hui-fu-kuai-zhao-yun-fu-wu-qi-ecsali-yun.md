# 云盘数据时间点备份恢复-快照-云服务器 ECS-阿里云

快照是指云盘数据在某个时刻的完整拷贝，是一种重要的数据容灾手段。通过快照可以定期备份云盘的业务数据，以应对误操作、攻击或病毒导致的数据丢失风险。如果遇到云盘数据丢失或异常时，可以通过快照将云盘数据完整地恢复到某一个时间点，以实现业务的连续性。

重要 ECS 实例不会自动备份存储在云盘上的数据，建议您创建 ECS 实例后定期为云盘创建快照备份数据，避免因变配、升级等重大运维操作、攻击或病毒等原因造成的数据丢失风险。

### 应用场景

推荐您在以下业务场景中使用阿里云快照。

* 日常数据备份\
  您可以使用自动快照策略定期为云盘创建快照，并保留一定时长，实现云盘数据的日常备份，以应对因误操作、病毒感染或恶意攻击可能出现的数据丢失风险。
* 高危操作护航\
  当您对 ECS 实例和云盘进行扩容、变配、迁移等运维操作时，可以提前手动创建快照，以便在出现问题时能够快速恢复业务。
* 数据快速恢复\
  当系统升级过程中出现软件兼容性问题或其他原因导致的服务中断时，可以通过云盘的历史快照回滚云盘，快速恢复业务，保证业务的连续性。
* 业务批量部署\
  您可以通过快照创建自定义镜像从而创建 ECS 实例，实现多个站点业务的批量、高效部署或升级。
* 批量数据分发\
  您可以通过快照批量创建新云盘并按需挂载至 ECS 实例，实现业务数据的快速分发。

说明 快照支持的资源粒度为单个云盘或一组云盘。如果您需要从 ECS 实例维度为该实例中的所有云盘创建快照，实现 ECS 整机备份或者整机克隆，您可以使用云备份的 ECS 整机备份 功能。 (链接原文: https://help.aliyun.com/zh/cloud-backup/user-guide/ecs-server-backup/ "")

### 快速了解快照

#### 快照原理

快照以数据块（存储系统中用于管理数据的基本单元）作为快照数据备份的最小单元。为云盘创建的第一份标准快照是全量快照，备份云盘中的所有数据块，后续标准快照均为增量快照，仅备份自上一次快照后新增或修改的数据块，这样可以节省快照的存储空间和使用成本。关于快照详细的原理说明，请参见 快照原理 (链接原文: https://help.aliyun.com/zh/ecs/user-guide/how-do-snapshots-work#concept-zbn-tzw-ydb "")。

#### 快照存储位置

快照创建完成后将默认存储在对象存储 OSS 中（此 OSS Bucket 用户不可见），以保障数据的长期安全与灵活恢复。出于数据安全性考虑，暂不支持使用自己创建的 OSS Bucket 存储快照数据。

* 在 OSS 支持同城冗余的地域，将默认使用同城冗余 OSS Bucket 来存储您的快照数据，以最大程度保证快照数据的冗余性。
* 在 OSS 暂不支持同城冗余的地域，将使用本地冗余 OSS Bucket 来存储您的快照数据。如果您的业务可用性要求较高，建议您使用 复制快照 来进一步跨地域备份数据。

有关对象存储 OSS 支持同城冗余的地域信息，请参见 存储冗余 (链接原文: https://help.aliyun.com/zh/oss/user-guide/overview-of-storage-redundancy-types/ "") 和 创建同城冗余存储Bucket (链接原文: https://help.aliyun.com/zh/oss/user-guide/zrs "")。

说明 使用快照创建云盘或回滚云盘后，需要把快照数据从 OSS 加载到云盘中，云盘被读取的数据会优先加载。该过程持续时间受快照数据量影响，需要几分钟到几小时。在快照数据被全部加载到云盘之前，云盘的读访问时延将会增加。一旦快照的所有数据块都被加载到云盘中，后续的读访问将恢复到正常性能水平。

#### 快照极速可用

云盘中存储的数据越多，快照创建后存储至 OSS 中所需时间越长。快照的极速可用能力实现快照创建后秒级可用，无需等待快照 100% 上传至 OSS 即可直接使用，例如创建云盘、回滚云盘、共享快照等。更多信息，请参见 快照极速可用能力 (链接原文: https://help.aliyun.com/zh/ecs/user-guide/enable-or-disable-the-instant-access-feature "")。

#### 快照数据安全

应安全合规要求，在数据存储、备份过程中建议对快照进行加密。快照加密可以确保对加密云盘（包括系统盘和数据盘）存储的数据进行备份时也是加密状态，即使快照数据泄露也无法解密，从而确保备份数据的机密性和完整性。

如果云盘属于加密云盘，其创建的快照将自动继承云盘的加密属性，快照数据在存储或传输过程中都处于加密状态。即使快照被复制到其他地域或用于恢复云盘，其内容仍然是加密的。更多信息，请参见 数据存储的机密性 (链接原文: https://help.aliyun.com/zh/ecs/user-guide/data-security/#c64647b872ddj "")。

### 快照类型

阿里云创建的云盘快照默认均是标准快照（Standard Snapshot），在使用标准快照过程中可以对快照进行归档，转换成 归档快照（Archive Snapshot）。标准快照和归档快照的主要区别如下：

| 对比项                  |                                                       标准快照 | 归档快照                                                                                                                                                                                    |
| -------------------- | ---------------------------------------------------------: | --------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| 应用场景                 |                     适用于日常数据保护场景，例如临时数据备份、使用快照创建新云盘进行业务分发等。 | 适用于低频使用、需要长期保存但又需考虑存储成本的场景。                                                                                                                                                             |
| 转换能力                 |                                             标准快照可以转换为归档快照。 | 归档快照无法还原为标准快照。                                                                                                                                                                          |
| 回滚云盘/创建新云盘/创建镜像/共享快照 |                                                        支持。 | 支持。 说明：支持共享归档快照，但不支持对共享来的快照进行归档。                                                                                                                                                        |
| 复制快照/加密快照            |                                                        支持。 | 不支持。                                                                                                                                                                                    |
| 快照保留时间               | - 1\~65,536 天；- 永久保留。 说明：如果阿里云账号发生欠费，对正在使用的快照会产生影响，详见欠费说明。 | <p>归档快照的保留时间由标准层保留时间（标准快照已存储时长）和归档层保留时间（归档快照后的保留时长）组成。<br>- 标准层：不可修改，标准快照保留时间 ≥ 14 天，才能归档。<br>- 归档层：60 天～（65,536 天 - 标准层保留时间），或永久保留。 说明：如果阿里云账号发生欠费，对正在使用的快照会产生影响，详见欠费说明。</p>           |
| 快照费用                 |                  单价以快照服务价格为准；计费项：根据标准快照容量和使用时长收取“标准快照存储费”。 | 单价以快照服务价格为准；计费项：根据归档快照容量和使用时长收取“归档快照存储费”。 重要：归档快照最短保留时间为 60 天（1,440 小时），若在 60 天内提前删除，需要支付归档快照不足规定时长费。更多信息，请参见 快照计费 (链接原文: https://help.aliyun.com/zh/ecs/snapshots-1#cdb5af0a32nsh "")。 |

### 快照功能

快照生命周期中常用功能包括（下表列出功能、说明与参考文档）：

| 功能          | 说明                                                                                                                    | 参考文档                                                                                                                                                                                                                                                                                                                                                                                                                                                          |
| ----------- | --------------------------------------------------------------------------------------------------------------------- | ------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| 创建快照        | 可以通过手动或自动方式创建标准快照。手动：为单块云盘手动创建快照，或通过快照一致性组为一台或多台 ECS 实例中的多块云盘同时创建快照以确保备份数据一致性。自动：创建自动快照策略并应用到云盘上，系统将按策略周期自动为单块云盘创建快照。 | <p>- 手动创建单个快照 (链接原文: https://help.aliyun.com/zh/ecs/user-guide/create-a-snapshot#concept-eps-gbl-xdb "")<br>- 创建快照一致性组 (链接原文: https://help.aliyun.com/zh/ecs/user-guide/create-a-snapshot-consistent-group#task-1997214 "")<br>- 创建自动快照策略 (链接原文: https://help.aliyun.com/zh/ecs/user-guide/create-an-automatic-snapshot-policy-1 "")<br>- 为云盘设置自动快照策略 (链接原文: https://help.aliyun.com/zh/ecs/user-guide/enable-or-disable-an-automatic-snapshot-policy "")</p> |
| 复制快照        | 可以通过快照复制功能跨地域复制快照，实现跨地域的数据备份。                                                                                         | 复制快照 (链接原文: https://help.aliyun.com/zh/ecs/user-guide/copy-a-snapshot#task-2438417 "")                                                                                                                                                                                                                                                                                                                                                                        |
| 归档快照        | 将不频繁访问但需长期保存的标准快照归档，以降低存储成本。                                                                                          | 归档快照 (链接原文: https://help.aliyun.com/zh/ecs/user-guide/archive-snapshots "")                                                                                                                                                                                                                                                                                                                                                                                   |
| 共享快照        | 将快照共享给其他阿里云账号或在资源目录内共享，其他账号可使用共享快照快速创建云盘。                                                                             | 共享快照 (链接原文: https://help.aliyun.com/zh/ecs/user-guide/share-a-snapshot "")                                                                                                                                                                                                                                                                                                                                                                                    |
| 使用快照回滚云盘    | 使用快照回滚单块云盘或通过快照一致性组同时回滚多块云盘以恢复数据。                                                                                     | <p>- 回滚云盘 (链接原文: https://help.aliyun.com/zh/ecs/user-guide/roll-back-a-disk-by-using-a-snapshot#concept-smh-y2l-xdb "")<br>- 通过快照一致性组回滚云盘 (链接原文: https://help.aliyun.com/zh/ecs/user-guide/roll-back-disks-by-using-a-snapshot-consistent-group "")</p>                                                                                                                                                                                                       |
| 使用快照创建云盘    | 使用快照创建新的数据盘，新盘数据与创建快照时原数据盘相同，可实现同可用区或跨可用区的数据复制。                                                                       | 使用快照创建云盘 (链接原文: https://help.aliyun.com/zh/ecs/user-guide/create-a-cloud-disk-using-a-snapshot "")                                                                                                                                                                                                                                                                                                                                                            |
| 使用系统盘快照创建镜像 | 通过系统盘快照创建自定义镜像，将操作系统及数据制作成环境副本，用该镜像创建多台 ECS 实例。                                                                       | 使用快照创建自定义镜像 (链接原文: https://help.aliyun.com/zh/ecs/user-guide/create-a-custom-image-from-a-snapshot "")                                                                                                                                                                                                                                                                                                                                                        |
| 删除快照        | 当不再需要快照或快照数量超出额度时，可删除快照释放存储空间，避免持续产生费用。                                                                               | 删除快照 (链接原文: https://help.aliyun.com/zh/ecs/user-guide/delete-a-snapshot-1 "")、删除快照一致性组 (链接原文: https://help.aliyun.com/zh/ecs/user-guide/modify-and-delete-a-snapshot-consistent-group#b7a89deb30nsn "")                                                                                                                                                                                                                                                       |

### 计费说明

* 初次使用快照前需先开通快照服务，开通快照不收费，创建快照后才开始计费。创建的手动快照和自动快照策略默认为标准快照，阿里云在各地域会根据标准快照容量和使用时长收取“标准快照存储费”。（参考：开通快照 / 手动快照 / 自动快照策略 文档链接在上文）
* 如果将标准快照归档为归档快照，会根据归档快照容量和使用时长收取“归档快照存储费”。归档快照最短保留时间为 60 天（1,440 小时），若在 60 天内提前删除，除需支付归档快照存储费外，还需支付“归档快照不足规定时长费”。
* 使用复制快照功能将标准快照复制到目标地域会在目标地域产生“复制快照流量费”和“标准快照存储费”。归档快照不支持复制。

更多关于快照计费的信息，请参见 快照计费 (链接原文: https://help.aliyun.com/zh/ecs/snapshots-1#cdb5af0a32nsh "")。

重要提醒 归档快照的最短保留时间为 60 天（1,440 小时），如果在 60 天内提前删除归档快照，除了需要支付归档快照存储费，还需支付归档快照不足规定时长费。

### 使用限制

使用快照过程中，请注意以下约束限制：

| 限制项     | 说明                                                                                                                                                                                                                                                                                                                                  |
| ------- | ----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| 快照额度    | <p>- 每块云盘可以保留的快照个数：手动创建标准快照：256；自动创建标准快照：1,000；归档快照：10,000。<br>- 单地域下每个账号可以保留的自动快照策略个数：100。<br>- 每块云盘可以设置的自动快照策略个数：1。<br>- 单块云盘支持同时存在的创建快照任务数上限（包括手动快照、自动快照、快照一致性组中的快照、镜像的快照）：ESSD 系列（ESSD、ESSD AutoPL、ESSD Entry、ESSD 同城冗余）：10；上一代云盘（SSD、高效、普通）：1。<br>- 单块云盘支持同时存在的归档任务数上限为 10 个（包括手动快照、自动快照、快照一致性组中的快照、镜像的快照），超过上限无法进行新的归档操作。</p> |
| 块存储类型   | <p>- ESSD PL-X 云盘、本地盘和弹性临时盘不支持创建快照。<br>- 目前仅 ESSD 系列云盘（ESSD、ESSD AutoPL、ESSD Entry）支持快照一致性组功能，且云盘未开启多重挂载功能时。<br>- 仅 ESSD 系列云盘（ESSD、ESSD AutoPL、ESSD Entry、ESSD 同城冗余）支持快照极速可用能力。更多信息，请参见 快照极速可用能力 文档链接。</p>                                                                                                                          |
| 下载或导出快照 | 不支持直接下载或导出已创建的快照。您可以先 使用快照创建自定义镜像 (链接原文: https://help.aliyun.com/zh/ecs/user-guide/create-a-custom-image-from-a-snapshot "")，然后再 导出自定义镜像 (链接原文: https://help.aliyun.com/zh/ecs/user-guide/export-a-custom-image "") 到本地。                                                                                                            |
| 其他限制    | <p>手动快照和自动快照创建过程中存在以下约束：<br>- ESSD 系列云盘支持手动和自动同时并发创建快照，但并发创建快照有最大个数限制（详见快照使用限制）。若并发创建的快照个数达到上限，后续并发创建快照会失败。<br>- 上一代云盘（SSD、高效、普通）：不支持手动和自动同时并发创建快照；在自动快照创建时间点，如果云盘正在执行创建快照任务（手动或自动），系统不会在该时间点创建自动快照，而会在下一个时间点正常创建；如果云盘正在执行自动快照任务，需等待自动快照完成后才能手动创建快照。关于手动快照和自动快照的其他区别，请参见 自动快照和手动快照的区别 文档链接。</p>                                     |

### 常见问题

<details>

<summary>查看快照 FAQ</summary>

使用快照的常见问题，请参见 快照 FAQ (链接原文: https://help.aliyun.com/zh/ecs/user-guide/snapshot-faq#concept-j5z-vrr-lgb "")。

</details>

***

参考与延伸阅读（页面原文中引用的部分重要链接）：

* 快照原理：https://help.aliyun.com/zh/ecs/user-guide/how-do-snapshots-work#concept-zbn-tzw-ydb
* 快照极速可用能力：https://help.aliyun.com/zh/ecs/user-guide/enable-or-disable-the-instant-access-feature
* 复制快照：https://help.aliyun.com/zh/ecs/user-guide/copy-a-snapshot
* 归档快照：https://help.aliyun.com/zh/ecs/user-guide/archive-snapshots
* 快照计费：https://help.aliyun.com/zh/ecs/snapshots-1

（以上内容保留原文中所有链接与说明，已清理导航与非正文内容。）
